<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapping Chili Peppers</title>
     <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">

    <style>
html, body {
    height: 100%;
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
}
header { /* need to add design to this*/

}

#map {
    flex-grow: 1; /* fill remaining space */
    width: 100%;
    height: 100%;
    margin: 0;
    padding: 0;
}

footer {
    background-color: #f8f9fa;
    text-align: center;
    padding: 10px 0;
    font-size: 0.9em;
    border-top: 1px solid #ddd;
    flex-shrink: 0;
    margin: 0;
}

.timeline-container {
    position: absolute;
    bottom: 80px;
    left: 50%;
    transform: translateX(-50%);
    width: 80%;
    padding: 15px;
    background: rgba(255, 255, 255, 0.8);
    border-radius: 8px;
    z-index: 1000;
}

.timeline-container input {
    width: 100%;
}
</style>

</head>

<body>
    <!-- Header-->
     <header>
        Mapping Chili Peppers Across the World <!-- This can change-->
     </header>

    <!-- Popup Modal -->
<div class="modal fade" id="overlay">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">Title Here</h4>
        </div>
        <div class="modal-body">
          <p>Info Here. 
</p>
<div class="modal-footer">     
    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
</div>

        </div>
      </div>
    </div>
  </div>
    <div id="map"></div>

     <!-- Timeline Slider -->. <!--We will need to change the years here! -->
     <div class="timeline-container">
        <label for="yearSlider">Select Year: <span id="selectedYear">1868</span></label>
        <input type="range" id="yearSlider" min="1868" max="1975" value="1868" step="1">
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script>
        // Initialize the map and set its view to the chosen geographical coordinates and zoom level
        var map = L.map('map').setView([20,0], 2); // Coordinates set to geographic center of the world

        // Add OpenStreetMap tiles- aesthetic 
       L.tileLayer (
        'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
        {
            maxZoom: 16, 
            attribution: 'Â© OpenStreetMap contributors'
        }
       ) .addTo(map);

       //overlay for a semi-transparent colored layer to highlight theme
       L.rectangle([[-90,-180], [90,180]], {
        color: "#FF4500",
        weight: 0,
        fillOpacity: 0.05,
       }) .addTo(map);

        // Trigger modal on map load
        map.whenReady(function() {
        $('#overlay').modal('show');  // This shows the popup once the map is fully ready. I use whenReady instead of OnLoad here 
});
        // GeoJSON dataset
        var dataset1 = [
        {
                type: 'Feature',
                geometry: {
                    type: 'Point',
                    coordinates: [-84.95258, 46.76947]
                },
                properties: {
                    title: Title, //Put Title here
                    description: Info, //Put description here
                    time: '1872/11/27', //If there is a date attached it goes here
                    image: image, // Replace with your image URL
             
                    icon: { 
                        iconUrl: url, // Authorship to Flat Icon for all icons
                        iconSize: [40, 40], // this can probably stay the same, this size worked well last time
                    iconAnchor: [3, 35],
                    popupAnchor: [0, -41],
                    className: 'dot',
                    }
                }
            }
        ];

         // Create markers for each chili pepper
         var markers = [];
        dataset1.forEach(function(pepper) {
            var marker = L.marker([pepper.geometry.coordinates[1], pepper.geometry.coordinates[0]], {icon: L.icon(pepper.properties.icon)});
            marker.bindPopup('<b>' + pepper.properties.title + '</b><br>' + pepper.properties.description + '<br><img src="' + pepper.properties.image + '" width="200px">');
            markers.push({marker: marker, time: new Date(pepper.properties.time).getFullYear()});
        });
        // Add markers to the map
        var markersLayer = L.layerGroup().addTo(map);

        // Function to filter markers based on selected year
        function filterMarkersByYear(year) {
            markersLayer.clearLayers(); // Clear existing markers
            markers.forEach(function(item) {
                if (item.time <= year) {
                    // Show markers for years up to and including the selected year
                    item.marker.addTo(markersLayer);
                    console.log('Marker added:', item.marker);
                }
            });
        }

         // Initialize the slider and update the map when the slider value changes
         var yearSlider = document.getElementById("yearSlider");
        var selectedYear = document.getElementById("selectedYear");

        yearSlider.addEventListener("input", function() {
           var year = parseInt(yearSlider.value);
           selectedYear.textContent = year;
           console.log('Selected Year:', year);
           filterMarkersByYear(year);
        }); 

         // Initial filter based on default slider value (what start year?)
         filterMarkersByYear(parseInt(yearSlider.value));
       
        // Function to handle each feature in the GeoJSON
        function onEachFeature(feature, layer) {
            if (feature.properties) {
                // Create content for the popup
                var content = `
                    <div style='clear: both'></div>
                    <div style='float: left; padding: 5px; margin-right: 10px'>
                        <img style='width: 200px;' src='${feature.properties.image}' alt='Ship Image' />
                    </div>
                    <div>
                        <h4>${feature.properties.title}</h4>
                        <p><strong>Year:</strong> ${feature.properties.time}</p>
                        <p>${feature.properties.description}</p>
                    </div>`;
                
                // Create a custom Leaflet icon
                var customIcon = L.icon({
                    iconUrl: feature,properties,icon,iconUrl,
                    iconSize: feature.properties.icon.iconSize || [40,40],
                    iconAnchor: feature.properties.icon.iconAnchor || [3,35],
                    popupAnchor: feature.properties.icon.popupAnchor || [0,-41]
                });

                // Set the custom icon for the layer
                layer.setIcon(customIcon);

                // Bind the popup to the layer
                layer.bindPopup(content, { closeButton: true });
            }
        }
        // Add the GeoJSON layer to the map
        var group1 = L.geoJSON(dataset1, {
            pointToLayer: function(feature, latlng) {
                return L.marker(latlng); // Use marker layers for points
            },
            onEachFeature: onEachFeature
        }).addTo(map);
    </script>
      <!-- Bootstrap JS dependencies -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.11.6/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

    <!--Footer-->
    <footer>
        &copy; 2025 Chili Mapping Project | Data Sources: <a href="https://www.openstreetmap.org/" target="_blank">OpenStreetMap</a>, <a href="https://stadiamaps.com/" target="_blank">Stadia Maps</a>
    </footer>
    <script src="script.js"></script>
</body>
</html>
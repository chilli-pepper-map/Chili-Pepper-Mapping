<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mapping Chili Peppers</title>

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

  <!-- Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
    }
    header {
      text-align: center;
      font-weight: bold;
      padding: 10px;
      background-color: #f8f9fa;
      border-bottom: 1px solid #ddd;
    }
    #map {
      flex-grow: 1;
      width: 100%;
      height: 100%;
      margin: 0;
      padding: 0;
    }
    footer {
      background-color: #f8f9fa;
      text-align: center;
      padding: 10px 0;
      font-size: 0.9em;
      border-top: 1px solid #ddd;
      flex-shrink: 0;
      margin: 0;
    }
    .timeline-container {
      position: absolute;
      bottom: 80px;
      left: 50%;
      transform: translateX(-50%);
      width: 80%;
      padding: 15px;
      background: rgba(255, 255, 255, 0.8);
      border-radius: 8px;
      z-index: 1000;
    }
    .timeline-container input {
      width: 100%;
    }
  </style>
</head>

<body>
  <header>Mapping Chili Peppers Across the World</header>

  <!-- ðŸŽµ Audio -->
  <audio id="intro-audio" preload="auto">
    <source src="path/to/red-hot-chili-peppers-intro.mp3" type="audio/mpeg">
  </audio>

  <!-- Modal Popup -->
  <div class="modal fade" id="overlay" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">Mapping Chili Peppers: Globally</h4>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p>Explore the world of chili peppers.</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    const overlayModal=new bootstrap.Modal(document.getElementById('overlay'));
    overlayModal.show();
  </script>

  <!-- Map -->
  <div id="map"></div>

  <!-- Timeline Slider -->
  <div class="timeline-container">
    <label for="yearSlider">Select Year: <span id="selectedYear">1492</span></label>
    <input type="range" id="yearSlider" min="1492" max="1900" value="1492" step="1">
  </div>

  <!-- Leaflet + Bootstrap JS -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    

    // Initialize map centered on Brazil
    var map = L.map('map').setView([-14.2350, -51.9253], 3);

    // Light muted map style (CartoDB Positron)
    L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>'
    }).addTo(map);

    // overlay for map tint to add a soft warmth
    L.rectangle([[-90, -180], [90, 180]], {
      color: "#FF4500",
      weight: 0,
      fillOpacity: 0.03
    }).addTo(map);

    // Show modal + play audio when map loads
    map.whenReady(function () {
      const overlayModal = new bootstrap.Modal(document.getElementById('overlay'));
      overlayModal.show();

      const audio = document.getElementById('intro-audio');
      audio.volume = 0.5;
      audio.play().catch(err => {
        console.warn("Autoplay blocked:", err);
      });
    });
    // Datasets

    const dataset1 = [
      {
        type: 'Feature',
        geometry: { type: 'Point', coordinates: [-2.0791, 42.4247] },
        properties: {
          title: 'Lodosa, Spain',
          description: 'Chilies were in regular use as a culinary ingredient.',
          time: '1513',
          icon: {
            iconUrl: 'images/food.png',
            iconSize: [40, 40],
            iconAnchor: [20, 40],
            popupAnchor: [0, -40]
          },
        }
      },
      {
        type: 'Feature',
        geometry: { type: 'Point', coordinates: [-8.2245, 39.399] },
        properties: {
          title: 'Portugal',
          description: 'The Portuguese, who discovered chilies (in Latin America) of their own accord in Brazil in 1500.',
          time: '1500',
          icon: {
            iconUrl: 'images/food.png',
            iconSize: [40, 40],
            iconAnchor: [20, 40],
            popupAnchor: [0, -40]
          },
        }
      },
      {
        type:'Feature',
        geometry: {type: 'Point', coordinates: [28.9784, 41.0082]}, 
        properties: {
          title: 'Ottoman Empire',
          description: 'After having successfully raided the Portuguese colony of Diu in India, the Ottomans could not contain their ebullience over discovering such a culinary treasure. From India, Ottomon Turks brought the chili pepper everywhere they went, taking it to Bulgaris and then Hungary.',
          time: '1538',
          icon: {
            iconUrl: 'images/food.png',
            iconSize: [40, 40],
            iconAnchor: [20, 40],
            popupAnchor: [0, -40]
          },
        }
      },
      {
        type:'Feature',
        geometry: {type: 'Point', coordinates: [19.0402,47.4979]}, 
        properties: {
          title: 'Hungary',
          description: 'After the introduction of chilies in the second half of the sixteenth century, Hungarian tables were set with salt and paprika, not black pepper. Paprike started out as a cheap alternative to prohibitively expensive pepper, making it an obvious hit with the peasantry, and from there it climbed the social ladder. When the trend-setting aristocrat Margit Szechy planted paprika in her garden in 1569, the spice began its slow ascent towards the kitchen.',
          time: '1569',
          icon: {
            iconUrl: 'images/food.png',
            iconSize: [40, 40],
            iconAnchor: [20, 40],
            popupAnchor: [0, -40]
          },
        }
      },
      {
        type: 'Feature',
        geometry: { type: 'Point', coordinates: [16.3464, 39.3088] },
        properties: {
          title: 'Calabria, Italy',
          description: 'Peppers were introduced to Italy from neighboring Spain early on, but it was centuries before they were widely used.',
          time: '1790',
          icon: {
            iconUrl: 'images/food.png',
            iconSize: [40, 40],
            iconAnchor: [20, 40],
            popupAnchor: [0, -40]
          },
        }
      }
            type: 'Feature',
      geometry: { type: 'Point', coordinates: [-7.4266, 43.7401] }, //longitude, latitude
      properties: {
        title: 'France', //Title
        description: 'After the introduction of chilies in the second half of the sixteenth century, Hungarian tables were set with salt and paprika, not black pepper. Paprika started out as a cheap alternative to prohibitively expensive pepper, making it an obvious hit with the peasantry, and from there it climbed the social ladder. When the trend-setting aristocrat Margit Szechy planted paprika in her garden in 1569, the spice began its slow ascent towards the kitchen. ', //add description
        time: '1870', //update date
        icon: {
          iconUrl: 'images/food.png', //flaticon image here,
          iconSize: [40, 40],
          iconAnchor: [20, 40],
          popupAnchor: [0, -40]
        },
      }

      type: 'Feature',
      geometry: { type: 'Point', coordinates: [120.9605, 23.6978] }, //longitude, latitude
      properties: {
        title: 'Taiwan', //Title
        description: 'Brian R. Dott estimates that the Dutch introduced chili pepper into Taiwan.', //add description
        time: '1640', //update date
        icon: {
          iconUrl: 'images/food.png', //flaticon image here,
          iconSize: [40, 40],
          iconAnchor: [20, 40],
          popupAnchor: [0, -40]
        },
      }

      type: 'Feature',
      geometry: { type: 'Point', coordinates: [6.6131, 0.1864] }, //longitude, latitude
      properties: {
        title: 'West Africa (SÃ£o TomÃ©)', //Title
        description: 'According to Nathan Nunn and Nancy Qian, "By 1493, capsicum peppers had arrived in Spain and Africa." By 1493, the Portugese already had trading ports in West Africa; this is the location of one such trading port. According to Jean Andrews, "after 1493, peppers from the Spanish Main were available to Portuguese for trade in their western African colonies."', //add description
        time: '1493', //update date
        icon: {
          iconUrl: 'images/food.png', //flaticon image here,
          iconSize: [40, 40],
          iconAnchor: [20, 40],
          popupAnchor: [0, -40]
        },
      }

      type: 'Feature',
      geometry: { type: 'Point', coordinates: [35.5296, 18.6657] }, //longitude, latitude
      properties: {
        title: 'Mozambique', //Title
        description: 'Vasco da Gama's arrival marks the earliest possible date of the chili pepper introduction.', //add description
        time: '1498', //update date
        icon: {
          iconUrl: 'images/food.png', //flaticon image here,
          iconSize: [40, 40],
          iconAnchor: [20, 40],
          popupAnchor: [0, -40]
        },
      }

      type: 'Feature',
      geometry: { type: 'Point', coordinates: [129.873, 32.747] }, //longitude, latitude
      properties: {
        title: 'Nagasaki', //Title
        description: 'According to Brian R. Dott, chilies likely entered Japan after the establishment of a Dutch trading post at Nagasaki in 1571.', //add description
        time: '1571', //update date
        icon: {
          iconUrl: 'images/food.png', //flaticon image here,
          iconSize: [40, 40],
          iconAnchor: [20, 40],
          popupAnchor: [0, -40]
        },
      }
    ];
    // Add marker to map, but don't add them yet
    const pepperMarkers = dataset1.map(feature => {
    const [lon, lat] = feature.geometry.coordinates;
    const marker = L.marker([lat, lon], { icon: L.icon(feature.properties.icon) });
    marker.bindPopup(`<b>${feature.properties.title}</b><br>${feature.properties.description}`);
    marker.feature = feature; // store feature data inside marker
    return marker;
  });

    //Year slider 
  const yearSlider = document.getElementById("yearSlider");
  const selectedYear = document.getElementById("selectedYear");

  yearSlider.addEventListener("input", () => {
    const currentYear = parseInt(yearSlider.value);
    selectedYear.textContent = currentYear;

    // Remove all markers first
    pepperMarkers.forEach(m => map.removeLayer(m));

    // Then add only those up to current year
    pepperMarkers.forEach(m => {
      if (m.feature.properties.time <= currentYear) {
        m.addTo(map);
      }
    });
  });
  // Show initial state (year 1492, no markers)
  yearSlider.dispatchEvent(new Event('input'));
  </script>

  <footer>
    &copy; 2025 Chili Mapping Project | Data Sources:
    <a href="https://www.openstreetmap.org/" target="_blank">OpenStreetMap</a>,
    <a href="https://stadiamaps.com/" target="_blank">Stadia Maps</a>
  </footer>
</body>
</html>

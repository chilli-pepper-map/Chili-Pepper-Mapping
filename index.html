<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mapping Chili Peppers</title>

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

  <!-- Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
    }
  header {
  text-align: center;
  font-weight: bold;
  padding: 10px;
  background-color: #f8f9fa;
  border-bottom: 1px solid #ddd;
  position: relative;
  overflow: hidden;
}
header::before {
  content: '';
  position: absolute;
  left: 25%;
  top: 50%;
  transform: translateY(-50%);
  width: 120px;
  height: 30px;
  background: url('images/food.png') repeat-x;
  background-size: 30px 30px;
  animation: float 3s ease-in-out infinite;
}
header::after {
  content: '';
  position: absolute;
  right: 25%;
  top: 50%;
  transform: translateY(-50%);
  width: 120px;
  height: 30px;
  background: url('images/food.png') repeat-x;
  background-size: 30px 30px;
  animation: float 3s ease-in-out infinite reverse;
}
@keyframes float {
  0%, 100% { transform: translateY(-50%); }
  50% { transform: translateY(-60%); }
}
    #map {
      flex-grow: 1;
      width: 100%;
      height: 100%;
      margin: 0;
      padding: 0;
    }
    footer {
      background-color: #f8f9fa;
      text-align: center;
      padding: 10px 0;
      font-size: 0.9em;
      border-top: 1px solid #ddd;
      flex-shrink: 0;
      margin: 0;
    }
    .timeline-container {
      position: absolute;
      bottom: 80px;
      left: 50%;
      transform: translateX(-50%);
      width: 80%;
      padding: 15px;
      background: rgba(255, 255, 255, 0.8);
      border-radius: 8px;
      z-index: 1000;
    }
    .timeline-container input {
      width: 100%;
    }
    .modal-title {
  position: relative;
  padding-left: 60px;
}
.modal-title::before {
  content: '';
  position: absolute;
  left: 0;
  top: 50%;
  transform: translateY(-50%);
  width: 50px;
  height: 25px;
  background: url('images/food.png') no-repeat center;
  background-size: contain;
}
  </style>
</head>

<body>
  <header>Mapping Chili Peppers' Journey to the World</header>

  <!-- ðŸŽµ Audio -->
  <audio id="intro-audio" preload="auto">
    <source src="path/to/red-hot-chili-peppers-intro.mp3" type="audio/mpeg">
  </audio>

  <!-- Modal Popup -->
  <div class="modal fade" id="overlay" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">Mapping Chili Peppers: A Global Journey</h4>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p>From the highlands of Central and South America to dinner tables around the globe, chili peppers have conquered the world with their irresistible heat and vibrant flavors.</p>
          <p> This interactive map traces how this humble spice traveled across the continents to become the absolute star of global cuisine. Use the timeline slider below to explore key moments in history when chili peppers made their mark in different places around the world.</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal will be shown after map loads (see map.whenReady) -->

  <!-- Map -->
  <div id="map"></div>

  <!-- Timeline Slider -->
  <div class="timeline-container">
    <label for="yearSlider">Select Year: <span id="selectedYear">1492</span></label>
    <input type="range" id="yearSlider" min="1492" max="1900" value="1492" step="1">
  </div>

  <!-- Leaflet + Bootstrap JS -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    

    // Initialize map centered on Brazil
    var map = L.map('map').setView([-14.2350, -51.9253], 3);

    // Light muted map style (CartoDB Positron)
    L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>'
    }).addTo(map);

    // overlay for map tint to add a soft warmth
    L.rectangle([[-90, -180], [90, 180]], {
      color: "#FF4500",
      weight: 0,
      fillOpacity: 0.03
    }).addTo(map);

    // Show modal + play audio when map loads
    map.whenReady(function () {
      const overlayModal = new bootstrap.Modal(document.getElementById('overlay'));
      overlayModal.show();

      const audio = document.getElementById('intro-audio');
      audio.volume = 0.5;
      audio.play().catch(err => {
        console.warn("Autoplay blocked:", err);
      });
    });
    // Datasets (simplified/cleaned to ensure valid JS)
    const dataset1 = [
      {
        type: 'Feature',
        geometry: { type: 'Point', coordinates: [120.1667, 30.2500] },
        properties: {
          title: 'Hangzhou',
          description: 'Chili peppers first appear in Hangzhou\'s local gazetteer in 1591, though they likely arrived earlier. This marks the earliest recorded appearance of chili peppers in central coastal China.',
          time: '1591',
          icon: { iconUrl: 'images/food.png', iconSize: [40, 40], iconAnchor: [20, 40], popupAnchor: [0, -40] }
        }
      },
      {
        type: 'Feature',
        geometry: { type: 'Point', coordinates: [74.1240, 15.2993] },
        properties: {
          title: 'Goa',
          description: 'Following the Portuguese conquest of Goa in 1510, chili peppers quickly took root here. The earliest records from 1542 confirm that chili cultivation was already well-established. Historian Brian R. Dott suggests the peppers were likely introduced sometime in the early 1500s, shortly after Portuguese arrival.',
          time: '1542',
          icon: { iconUrl: 'images/food.png', iconSize: [40, 40], iconAnchor: [20, 40], popupAnchor: [0, -40] }
        }
      },
      {
        type: 'Feature',
        geometry: { type: 'Point', coordinates: [123.4330, 41.8048] },
        properties: {
          title: 'Fengtian',
          description: 'The earliest record of chili peppers in northeastern China comes from Fengtian (an old name for Shenyang) in 1682. Historian Brian R. Dott estimates the initial introduction likely occurred around the 1650s via Korea.',
          time: '1682',
          icon: { iconUrl: 'images/food.png', iconSize: [40, 40], iconAnchor: [20, 40], popupAnchor: [0, -40] }
        }
      },
       {
        type: 'Feature',
        geometry: { type: 'Point', coordinates: [127.726, 37.658] },
        properties: {
          title: 'Korea',
          description: 'The earliest known record of chili peppers on the Korean Peninsula dates to 1614, though the introduction must have occurred earlier. Historian Brian R. Dott estimates the peppers likely arrived in the 1590s during the Japanese invasions of Korea.',
          time: '1614',
          icon: { iconUrl: 'images/food.png', iconSize: [40, 40], iconAnchor: [20, 40], popupAnchor: [0, -40] }
        }
      },
      {
        type: 'Feature',
        geometry: { type: 'Point', coordinates: [102.2501, 2.1896] },
        properties: {
          title: 'Malacca',
          description: 'According to Brian R. Dott, Chilli peppers were likely introduced to the Malacca area by 1540.',
          time: '1614',
          icon: { iconUrl: 'images/food.png', iconSize: [40, 40], iconAnchor: [20, 40], popupAnchor: [0, -40] }
        }
      }
  
    ];
    
    // Add marker to map, but don't add them yet
    const pepperMarkers = dataset1.map(feature => {
    const [lon, lat] = feature.geometry.coordinates;
    const marker = L.marker([lat, lon], { icon: L.icon(feature.properties.icon) });
    marker.bindPopup(`<b>${feature.properties.title}</b><br>${feature.properties.description}`);
    marker.feature = feature; // store feature data inside marker
    return marker;
  });

    //Year slider 
  const yearSlider = document.getElementById("yearSlider");
  const selectedYear = document.getElementById("selectedYear");

  yearSlider.addEventListener("input", () => {
    const currentYear = parseInt(yearSlider.value);
    selectedYear.textContent = currentYear;

    // Remove all markers first
    pepperMarkers.forEach(m => map.removeLayer(m));

    // Then add only those up to current year
    pepperMarkers.forEach(m => {
      if (m.feature.properties.time <= currentYear) {
        m.addTo(map);
      }
    });
  });
  // Show initial state (year 1492, no markers)
  yearSlider.dispatchEvent(new Event('input'));
  </script>

  <footer>
    &copy; 2025 Chili Mapping Project | Data Sources:
    <a href="https://www.openstreetmap.org/" target="_blank">OpenStreetMap</a>,
    <a href="https://stadiamaps.com/" target="_blank">Stadia Maps</a>
  </footer>
</body>
</html>